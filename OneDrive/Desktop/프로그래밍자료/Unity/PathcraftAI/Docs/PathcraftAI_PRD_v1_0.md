# 🎮 Pathcraft AI — PRD v1.0

## 🧭 프로젝트 개요
**프로젝트명:** Pathcraft AI (POE 빌드 코치)  
**장르:** 게임 도구 / AI 보조 애플리케이션  
**대상 게임:** Path of Exile 1 & 2  
**개발 언어:** C# (.NET 8), Python (파서)  
**개발 인원:** 1인 개발  
**플랫폼:** Windows (추후 모바일 고려)  
**목표 사용자:** POE 초보~중급 유저, HC 빌드 유저  
**배포 형태:** 오픈소스 (상업 금지), 커뮤니티 기반  
**GitHub:** https://github.com/JinHyeokPark28/Pathcraft-AI

---

## 🎯 핵심 목표
1. POE 빌드의 "무엇(What)" 뿐 아니라 "왜(Why)" 를 설명하는 AI 보조 도구
2. 대화형 추천, 실시간 분석, 오버레이 정보 표시
3. 초보자도 쉽게 사용할 수 있는 직관적 UI
4. 스태시(보관함) 분석 및 아이템 가격 책정 보조

---

## 🎨 브랜딩
- **단일 브랜드명:** Pathcraft AI
- **하위 이름 없음**
- **로고:** (추후 디자인)
- **테마 컬러:** POE 게임 스타일 (어두운 톤 + 금색/보라색 강조)

---

## 🧩 시스템 구조 개요

### 1. 데이터 파이프라인
```
POB 파일 → pob_parser.py → JSON → 정규화 → 빌드 분석
```

### 2. AI 파이프라인
```
빌드 데이터 → AI 분석 (ChatGPT/Gemini) → 추천 생성 → UI 표시
```

### 3. 가격 파이프라인
```
poe.ninja API → 실시간 시세 → 스태시 아이템 분석 → 가격 추천
```

---

## ⚙️ 핵심 기능

### 1. POB 빌드 분석
#### 1.1 POB 파일 불러오기
- **지원 형식:** `.xml` (Path of Building 내보내기 파일)
- **자동 감지:** 클립보드 모니터링 (선택적)
- **수동 로드:** 파일 탐색기로 드래그 앤 드롭

#### 1.2 빌드 데이터 정규화
- **파싱 항목:**
  - DPS (총 DPS, 주 스킬 DPS)
  - 생존력 (HP, ES, 방어도, 회피, 블록)
  - 저항 (불/냉기/번개/카오스)
  - 패시브 트리 분석
  - 아이템 슬롯 (무기, 방어구, 악세서리)
  - 젬 링크 구성
  - 플라스크 설정
  - 주얼 배치

#### 1.3 데이터 출력
- **저장 경로:** `/home/claude/build_output.json`
- **구조:**
```json
{
  "buildName": "Righteous Fire Chieftain",
  "class": "Marauder",
  "ascendancy": "Chieftain",
  "level": 90,
  "dps": {
    "total": 1500000,
    "mainSkill": "Righteous Fire"
  },
  "defense": {
    "life": 7500,
    "energyShield": 0,
    "armour": 25000,
    "evasion": 0,
    "block": 10
  },
  "resistances": {
    "fire": 75,
    "cold": 75,
    "lightning": 75,
    "chaos": -20
  },
  "passiveTree": [...],
  "items": [...],
  "gems": [...]
}
```

---

### 2. AI 빌드 분석 시스템

#### 2.1 분석 단계
AI는 다음 순서로 빌드를 분석합니다:

**Step 1: 빌드 개요 분석**
- 빌드 컨셉 파악 (RF, Poison, Crit, Minion 등)
- 메인 스킬 및 보조 스킬 구성
- 아센던시 특성 활용도

**Step 2: DPS 분석**
- 현재 DPS 수준 평가
- poe.ninja 상위 10% 빌드와 비교
- DPS 증가를 위한 우선순위 제안

**Step 3: 생존력 분석**
- HP/ES 충분성 (레벨 대비)
- 물리 피해 감소율
- 저항 부족 항목 체크
- 블록/회피/도지 메커니즘 평가

**Step 4: 패시브 트리 분석**
- 효율적인 패시브 경로인지 평가
- 불필요한 패시브 포인트 낭비 체크
- 추천 대체 경로

**Step 5: 아이템 추천**
- 업그레이드 우선순위 제안
- 예산별 대체 아이템 (1c / 10c / 50c / 1div+)
- 시너지 아이템 조합

#### 2.2 AI 모델 선택
- **기본:** ChatGPT API (GPT-4 Turbo)
- **대안:** Google Gemini API
- **설정:** 사용자가 API 키 입력 및 모델 선택 가능
- **로컬 모드:** API 없이도 기본 분석 가능 (AI 설명 없음)

#### 2.3 프롬프트 전략
AI에게 역할을 분리하여 호출:

**프롬프트 1 - 빌드 전문가 모드:**
```
당신은 Path of Exile의 빌드 전문가입니다.
아래 빌드 데이터를 분석하고, 강점과 약점을 설명하세요.

[빌드 데이터 삽입]

다음 형식으로 답변하세요:
1. 빌드 컨셉 요약
2. 주요 강점 3가지
3. 주요 약점 3가지
4. 개선 우선순위 Top 3
```

**프롬프트 2 - 아이템 추천 모드:**
```
당신은 POE 아이템 시장 전문가입니다.
현재 빌드에 맞는 업그레이드 아이템을 추천하세요.

[빌드 데이터 + 현재 시세 정보]

예산별로 추천하세요:
- 저예산 (1-10 Chaos)
- 중예산 (10-50 Chaos)
- 고예산 (1+ Divine)
```

**프롬프트 3 - 가격 책정 모드:**
```
당신은 POE 아이템 가격 평가 전문가입니다.
스태시의 아이템을 분석하여 판매 가격을 제안하세요.

[아이템 데이터 + poe.ninja 시세]

각 아이템마다:
1. 추정 가격 (Chaos Orb)
2. 가격 산정 근거
3. 빠른 판매 vs 최대 이익 가격
```

---

### 3. 스태시(보관함) 분석 시스템

#### 3.1 OAuth 로그인
- **GGG OAuth 2.0 연동**
- **필요 권한:**
  - `account:profile` (계정 정보)
  - `account:stashes` (보관함 접근)
- **토큰 저장:** 로컬 암호화 파일
- **자동 갱신:** 토큰 만료 시 자동 재로그인

#### 3.2 스태시 스캔
- **스캔 대상:** 모든 보관함 탭
- **데이터 수집:**
  - 아이템 이름
  - 아이템 타입
  - 속성 (Life, Res, DPS 등)
  - 희귀도 (일반/마법/희귀/고유)
  - 아이템 레벨
  - 링크 수

#### 3.3 아이템 가격 책정
- **데이터 소스:** poe.ninja Economy API
- **실시간 시세:** Chaos Orb 기준
- **가격 책정 로직:**
  1. poe.ninja에서 유사 아이템 시세 조회
  2. 아이템 속성 비교 (Life, Res, DPS)
  3. AI에게 최종 가격 산정 요청
  4. 빠른 판매 가격 vs 최대 이익 가격 제시

#### 3.4 추천 시스템
- **판매 추천:** "이 아이템은 30 Chaos에 팔 수 있습니다"
- **보관 추천:** "이 아이템은 당신의 빌드에 유용합니다"
- **폐기 추천:** "이 아이템은 가치가 낮습니다 (1 Alch 이하)"

---

### 4. 오버레이 시스템

#### 4.1 오버레이 UI
- **형태:** 투명 WPF 창
- **위치:** 화면 우측 상단 (이동 가능)
- **크기:** 400×600 (조절 가능)
- **투명도:** 80% (조절 가능)

#### 4.2 표시 정보
**기본 뷰 (초보자용):**
- 빌드 요약 (DPS / HP / Res)
- AI 추천 Top 3
- 스태시 아이템 개수
- 예상 자산 가치 (Chaos 기준)

**세부 뷰 (숙련자용):**
- DPS 계산 세부 항목
- 패시브 트리 효율도
- 아이템 슬롯별 업그레이드 우선순위
- 저항/방어 상세 분석

#### 4.3 오버레이 기능
- **핫키 토글:** Ctrl + F8 (On/Off)
- **클릭 스루:** Ctrl + F9 (마우스 투과)
- **ESC 닫기**
- **자동 갱신:** 1초마다 `build_output.json` 체크
- **스태시 하이라이트:** 추천 아이템에 라벨 표시

---

### 5. 모드 구분

#### 5.1 리그 모드
- **Trade League (기본):** poe.trade 연동
- **SSF (Solo Self-Found):** 거래 불가, 아이템 추천 제한
- **HC (Hardcore):** 생존력 우선 분석

#### 5.2 게임 버전
- **POE 1 (기본)**
- **POE 2 (추후 지원, 우선순위 낮음)**

---

### 6. 데이터 소스

#### 6.1 poe.ninja API
- **Economy API:**
  - 아이템 시세 (Chaos/Divine)
  - 커런시 환율
  - 유니크 아이템 가격
  - 젬 가격
  - 디바인/엑잘티드 시세

- **Builds API:**
  - 상위 빌드 통계
  - 인기 스킬
  - 인기 아센던시
  - 평균 DPS/HP

#### 6.2 POB Community Fork
- **XML 파서:** `pob_parser.py` (Python)
- **지원 버전:** 최신 POB Community Fork
- **호환성:** Path of Building 공식 버전 지원

---

## 🖥️ 기술 스택

| 영역 | 기술 |
|------|------|
| 프레임워크 | .NET 8 WPF |
| 언어 | C# 12 + Python 3.11 |
| 파서 | pob_parser.py (Python) |
| AI | ChatGPT API / Gemini API |
| OAuth | GGG OAuth 2.0 |
| 데이터 | SQLite (로컬 캐시) + JSON |
| UI | WPF (XAML + C#) |
| 오버레이 | 투명창 + 핫키 |
| 배포 | GitHub Releases (오픈소스) |

---

## 📁 프로젝트 구조

```
PathcraftAI/
 ┣ PathcraftAI.UI/           (WPF 메인 앱)
 ┣ PathcraftAI.Core/          (핵심 로직)
 ┣ PathcraftAI.Parser/        (POB 파서 C# 래퍼)
 ┣ PathcraftAI.LLM/           (AI 통신)
 ┣ PathcraftAI.Storage/       (데이터 저장)
 ┣ PathcraftAI.Overlay/       (오버레이 창)
 ┣ PathcraftAI.DataMiner/     (데이터 마이닝 도구 - 별도 실행파일)
 ┣ PathcraftAI.Tests/         (단위 테스트)
 ┗ python/
    ┗ pob_parser.py           (POB XML → JSON)
```

---

## 🛠️ 데이터 마이닝 도구 (PathcraftAI.DataMiner)

### 목적
poe.ninja와 같은 외부 소스에서 데이터를 수집하기 위한 **별도의 콘솔 애플리케이션**

### 주요 기능

#### 1. poe.ninja 데이터 수집
- **대상 데이터:**
  - Economy (아이템 시세)
  - Builds (빌드 통계)
  - Currency (환율)
  - Unique Items (고유템 가격)
  
- **수집 방법:**
  - 개발자 도구로 API 엔드포인트 분석
  - HTTP 요청으로 JSON 데이터 수집
  - Rate Limiting 준수 (요청 간격 조절)

#### 2. 데이터 정규화
- **변환 과정:**
  ```
  poe.ninja JSON → 정규화 → SQLite DB / JSON 파일
  ```
  
- **저장 형식:**
  - SQLite: 빌드 통계, 아이템 시세 (쿼리 최적화)
  - JSON: 빠른 로드용 캐시

#### 3. 스케줄링
- **자동 수집:** 1일 1회 (새벽 4시)
- **수동 수집:** 사용자가 원할 때 즉시 실행
- **점진적 업데이트:** 변경된 데이터만 수집

#### 4. 데이터 검증
- **무결성 체크:** 
  - 필수 필드 존재 확인
  - 데이터 타입 검증
  - 중복 제거
  
- **에러 핸들링:**
  - API 장애 시 이전 데이터 유지
  - 로그 기록 (`logs/dataminer.log`)

### 실행 방법

#### 콘솔 명령어
```bash
# 전체 수집
PathcraftAI.DataMiner.exe --collect-all

# 특정 데이터만 수집
PathcraftAI.DataMiner.exe --economy-only
PathcraftAI.DataMiner.exe --builds-only

# 스케줄 등록 (Windows Task Scheduler)
PathcraftAI.DataMiner.exe --schedule
```

#### UI 통합 (선택)
- 메인 앱의 설정 → "데이터 업데이트" 버튼
- 내부적으로 DataMiner 실행

### 출력 결과
```
/data/
  ┣ economy.db          (SQLite)
  ┣ builds.db           (SQLite)
  ┣ cache/
  ┃  ┣ economy.json     (빠른 로드용)
  ┃  ┗ builds.json
  ┗ logs/
     ┗ dataminer.log
```

### 개발 우선순위
- **Phase 3 이전:** 기본 수집 기능 (P10~P12와 병행)
- **Phase 5 이후:** 스케줄링 및 자동화

---

## 🔒 보안 및 프라이버시

### OAuth 토큰 관리
- **저장 위치:** `%APPDATA%/PathcraftAI/tokens.dat`
- **암호화:** AES-256
- **권한 최소화:** 읽기 전용 (쓰기 권한 불필요)

### API 키 관리
- **사용자 입력:** 설정 창에서 직접 입력
- **저장 위치:** 로컬 암호화 파일
- **전송:** HTTPS만 사용

### 데이터 수집
- **수집 항목:** 없음 (완전 로컬)
- **텔레메트리:** 비활성화
- **서버:** 없음 (오프라인 우선)

---

## 🎮 사용자 시나리오

### 시나리오 1: 초보자 빌드 체크
```
1. 사용자가 POB에서 빌드 내보내기
2. Pathcraft AI에서 "파일 열기" 클릭
3. 빌드 자동 분석
4. AI가 쉬운 언어로 설명:
   "당신의 Righteous Fire 빌드는 DPS가 약간 낮습니다.
    Kaom's Heart를 착용하면 HP와 DPS가 크게 증가합니다.
    현재 시세는 약 50 Chaos입니다."
```

### 시나리오 2: 스태시 정리
```
1. GGG 계정으로 로그인
2. "스태시 스캔" 버튼 클릭
3. AI가 각 아이템 분석:
   - 이 반지: 30 Chaos에 판매 추천
   - 이 벨트: 당신의 빌드에 유용함 (보관 추천)
   - 이 갑옷: 가치 낮음 (폐기 추천)
```

### 시나리오 3: 실시간 게임 중 사용
```
1. POE 게임 실행
2. Pathcraft AI 오버레이 활성화 (Ctrl + F8)
3. 오버레이에 실시간 빌드 요약 표시:
   - DPS: 1.5M
   - HP: 7.5K
   - 저항: 불75 / 냉75 / 번75 / 카-20
   - AI 추천: "카오스 저항이 낮습니다. Amethyst Ring 추천"
```

---

## 🗺️ 개발 로드맵

### Phase 1: 핵심 기능 (현재 진행 중)
- [x] 프로젝트 구조 생성
- [x] POB 파서 연동
- [x] 기본 UI 창
- [x] Overlay 기본 구조
- [x] 핫키 토글 (Ctrl + F8/F9)
- [x] 클릭 스루 기능
- [ ] **다음: 스태시 스캔 목업**

### Phase 2: AI 통합
- [ ] ChatGPT API 연동
- [ ] 빌드 분석 프롬프트 작성
- [ ] AI 응답 파싱 및 UI 표시
- [ ] Gemini API 대안 추가

### Phase 3: OAuth 및 스태시
- [ ] GGG OAuth 로그인
- [ ] 스태시 API 연동
- [ ] 아이템 데이터 수집
- [ ] 실시간 시세 연동 (poe.ninja)

### Phase 4: 가격 책정 AI
- [ ] poe.ninja Economy API 연동
- [ ] 아이템 가격 산정 로직
- [ ] AI 가격 책정 프롬프트
- [ ] 판매/보관/폐기 추천

### Phase 5: 고도화
- [ ] 빌드 비교 기능 (상위 10% vs 내 빌드)
- [ ] 패시브 트리 시각화
- [ ] 아이템 시뮬레이터 (장착 전 미리보기)
- [ ] 다중 빌드 저장 및 관리

### Phase 6: POE 2 지원
- [ ] POE 2 빌드 구조 분석
- [ ] POE 2 파서 개발
- [ ] POE 2 전용 AI 프롬프트

---

## 📊 성공 지표

### 사용성 지표
- 평균 분석 시간: < 3초
- AI 응답 시간: < 10초
- 오버레이 FPS: > 30
- 메모리 사용량: < 200MB

### 정확도 지표
- 가격 책정 정확도: ±20% 이내
- 저항 분석 정확도: 100%
- DPS 계산 정확도: ±5% 이내

### 커뮤니티 지표
- GitHub Star: 목표 500+
- 월간 사용자: 목표 1000+
- 커뮤니티 피드백 반영률: 80%+

---

## 💬 핵심 가치

> "POE는 복잡하지만, 당신의 빌드는 단순해질 수 있습니다."  
> "아이템 가치를 모르는 초보자도 공정한 가격에 거래할 수 있습니다."  
> — 정보 격차 해소, 초보자 친화적

---

## 📋 제외 사항 (추후 고려)

- 자동 거래 봇 (GGG 규정 위반)
- 게임 내 매크로 (규정 위반)
- 실시간 DPS 미터 (규정 위반 가능성)
- 플라스크 타이머 (규정 회색지대)

---

## 🛠️ 개발 원칙

1. **리팩토링 금지:** 작동하는 코드는 건드리지 않기
2. **누적 확장:** 새 기능은 기존 코드에 추가만
3. **오프라인 우선:** 인터넷 없이도 기본 기능 작동
4. **오픈소스:** 커뮤니티 기여 환영
5. **GGG 규정 준수:** 게임 규칙 절대 위반 금지

---

## 🔧 설치 및 배포

### 최소 요구사항
- OS: Windows 10 이상
- .NET 8 Runtime
- Python 3.11 (자동 설치)
- 디스크: 100MB
- RAM: 2GB

### 설치 방법
1. GitHub Releases에서 최신 버전 다운로드
2. `PathcraftAI.exe` 실행
3. (선택) API 키 입력 (설정 → API 설정)
4. POB 파일 불러오기

---

_작성자: Claude Sonnet 4.5_  
_최종 업데이트: 2025-11-02 (v1.0)_  
_문서 상태: 개발 진행 중_  
_참고: 알케미스트 저니 PRD 포맷 기반_
